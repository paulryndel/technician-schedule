<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technician Schedule</title>
    <style>
        /* ---- iOS Calendar+ Styles ---- */
        .ios-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            background: #f8fafc;
            padding: 12px;
            border-radius: 24px;
        }
        .ios-calendar-day {
            background: white;
            border-radius: 16px;
            min-height: 80px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            position: relative;
            padding: 8px 6px 5px 6px;
            transition: box-shadow 0.2s;
            cursor: pointer;
            text-align: left;
            display: flex;
            flex-direction: column;
        }
        .ios-calendar-day.today {
            background: #fffbe6;
            border: 2px solid #f59e0b;
        }
        .ios-calendar-day-num {
            font-weight: 700;
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 2px;
        }
        .ios-calendar-tech-list {
            margin-top: 2px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px 5px;
        }
        .ios-calendar-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
            display: inline-block;
        }
        .ios-calendar-tech-dot {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            line-height: 1;
            border-radius: 6px;
            padding: 2px 4px;
            margin-bottom: 2px;
            background: #f3f4f6;
        }
        .ios-calendar-weekday {
            font-weight: 700;
            text-align: center;
            color: #64748b;
            margin-bottom: 4px;
            font-size: 0.95rem;
            letter-spacing: 0.05em;
        }
        .ios-calendar-day.inactive {
            background: #f1f5f9;
            color: #aaa;
            cursor: default;
        }
        @media (max-width: 600px) {
            .ios-calendar-grid { gap: 5px; }
            .ios-calendar-day { min-height: 50px; padding: 4px 2px 2px 2px; }
            .ios-calendar-day-num { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="tabs">
        <button id="calendarplus-tab" class="tab-btn px-4 py-2 font-medium text-sm rounded-t-lg border-b-2 border-transparent">Calendar+</button>
    </div>
    <div id="report-view" class="hidden">...</div>
    <div id="calendarplus-view" class="hidden">
        <div class="flex justify-end mb-4 no-print">
            <button id="print-calendarplus-btn" class="print-button flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                Print iOS Calendar
            </button>
        </div>
        <div class="bg-white rounded-3xl shadow-lg p-4 max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-4">
                <button id="ios-prev-month" class="p-2 rounded-full hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <div id="ios-calendarplus-month" class="text-xl font-semibold text-gray-700"></div>
                <button id="ios-next-month" class="p-2 rounded-full hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div id="calendarplus-container"></div>
        </div>
    </div>
    <script>
        // --- Calendar+ Tab logic ---
        document.getElementById('calendarplus-tab').addEventListener('click', function() {
            document.getElementById('calendar-view').classList.add('hidden');
            document.getElementById('gantt-view').classList.add('hidden');
            document.getElementById('report-view').classList.add('hidden');
            document.getElementById('calendarplus-view').classList.remove('hidden');
            setActiveTab(this);
            renderIOSCalendar();
        });
        function setActiveTab(tabBtn) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            tabBtn.classList.add('active');
        }

        // --- Use your real schedule data array here! ---
        // Example: window.technicianSchedules = [{date:'2025-08-23', technician:'John', color:'#2563eb', job:'Install'}]
        // If you already have a global schedule data, use that!
        window.technicianSchedules = window.technicianSchedules || [];

        // --- iOS Calendar state
        let iosMonthOffset = 0;

        // --- Render iOS Calendar+ ---
        function renderIOSCalendar() {
            const now = new Date();
            const showDate = new Date(now.getFullYear(), now.getMonth() + iosMonthOffset, 1);
            const y = showDate.getFullYear();
            const m = showDate.getMonth();

            // Weekday header
            let html = '<div class="ios-calendar-grid">';
            ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d => 
                html += `<div class="ios-calendar-weekday">${d}</div>`
            );
            // First day offset
            let firstDay = new Date(y, m, 1).getDay();
            let daysInMonth = new Date(y, m+1, 0).getDate();
            let prevMonthDays = new Date(y, m, 0).getDate();

            // Previous month's trailing days (inactive)
            for(let i=0; i<firstDay; i++) {
                let d = prevMonthDays - firstDay + i + 1;
                html += `<div class="ios-calendar-day inactive"><span class="ios-calendar-day-num">${d}</span></div>`;
            }

            // Current month days
            for(let d=1; d<=daysInMonth; d++) {
                let dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const today = (new Date().toDateString() === new Date(y,m,d).toDateString());
                // Technicians for this date
                let techs = (window.technicianSchedules||[]).filter(ev => ev.date === dateStr);
                html += `<div class="ios-calendar-day${today?' today':''}" data-date="${dateStr}">
                    <div class="ios-calendar-day-num">${d}</div>
                    <div class="ios-calendar-tech-list">${
                        techs.map(ev => 
                            `<span class="ios-calendar-tech-dot" style="color:${ev.color||'#2563eb'};">
                                <span class="ios-calendar-dot" style="background:${ev.color||'#2563eb'};"></span>
                                ${ev.technician}
                            </span>`
                        ).join('')
                    }</div>
                </div>`;
            }

            // Fill trailing days of grid with next month (inactive)
            let total = firstDay + daysInMonth;
            for(let i=0; i< (7 - (total%7))%7; i++) {
                html += `<div class="ios-calendar-day inactive"><span class="ios-calendar-day-num">${i+1}</span></div>`;
            }
            html += '</div>';
            document.getElementById('calendarplus-container').innerHTML = html;

            // Set month header
            document.getElementById('ios-calendarplus-month').textContent =
                showDate.toLocaleString('default', {month:'long', year:'numeric'});

            // Prev/Next
            document.getElementById('ios-prev-month').onclick = ()=>{
                iosMonthOffset--;
                renderIOSCalendar();
            };
            document.getElementById('ios-next-month').onclick = ()=>{
                iosMonthOffset++;
                renderIOSCalendar();
            };

            // Modal on day click (use your event-modal model)
            document.querySelectorAll('.ios-calendar-day:not(.inactive)').forEach(day=>{
                day.onclick = function() {
                    let date = day.getAttribute('data-date');
                    showEventModalForDate(date);
                };
            });
        }

        // --- This function fills and shows your existing #event-modal for Calendar+ ---
        function showEventModalForDate(dateStr) {
            // Format for modal header
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const date = new Date(dateStr);
            document.getElementById('modal-date').textContent = date.toLocaleDateString(undefined, options);
            // Clear previous events
            const modalEvents = document.getElementById('modal-events');
            modalEvents.innerHTML = '';
            // Get events for this date
            const techs = (window.technicianSchedules||[]).filter(ev => ev.date === dateStr);
            if (techs.length === 0) {
                modalEvents.innerHTML = '<div class="text-gray-500 italic">No technician schedule for this day.</div>';
            } else {
                techs.forEach(ev => {
                    const color = ev.color || '#2563eb';
                    const elem = document.createElement('div');
                    elem.className = 'flex items-center gap-3 p-3 rounded-lg border border-gray-100 bg-gray-50';
                    elem.innerHTML = `
                        <span class="ios-calendar-dot" style="background:${color};"></span>
                        <span class="font-semibold" style="color:${color};">${ev.technician}</span>
                        <span class="text-xs text-gray-600">${ev.job||''}</span>
                    `;
                    modalEvents.appendChild(elem);
                });
            }
            document.getElementById('event-modal').classList.remove('hidden');
        }

        // Modal close logic (if not already present)
        document.getElementById('close-modal').onclick = function() {
            document.getElementById('event-modal').classList.add('hidden');
        };

        // Optional: Print button for Calendar+
        document.getElementById('print-calendarplus-btn').onclick = function() {
            let orig = document.body.innerHTML;
            let section = document.getElementById('calendarplus-view').innerHTML;
            document.body.innerHTML = section;
            window.print();
            document.body.innerHTML = orig;
            location.reload();
        };
    </script>
</body>
</html>
